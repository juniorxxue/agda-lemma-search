<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agda Lemma Search - Multi-codebase</title>
    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            margin: 0; padding: 0;
            background-color: #1e1e1e; color: #d4d4d4; line-height: 1.4;
            display: flex; height: 100vh; overflow: hidden;
        }
        
        /* Sidebar for Unicode Picker */
        .sidebar {
            width: 280px; min-width: 280px;
            background-color: #252526; border-right: 1px solid #404040;
            overflow-y: auto; z-index: 200;
            display: flex; flex-direction: column;
            transition: width 0.3s ease, min-width 0.3s ease;
        }
        
        .sidebar.collapsed {
            width: 0; min-width: 0;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 16px; border-bottom: 1px solid #404040;
            background-color: #2d2d2d; position: sticky; top: 0; z-index: 300;
        }
        
        .sidebar-title {
            color: #569cd6; font-weight: bold; font-size: 14px;
            text-transform: uppercase; letter-spacing: 0.5px; margin: 0;
        }
        
        .unicode-picker {
            padding: 16px; flex: 1; overflow-y: auto;
        }
        
        .unicode-category {
            margin-bottom: 20px;
        }
        
        .category-title {
            color: #569cd6; font-size: 11px; font-weight: bold;
            margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px;
            padding-bottom: 4px; border-bottom: 1px solid #404040;
        }
        
        .unicode-symbols {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(32px, 1fr));
            gap: 4px; margin-top: 8px;
        }
        
        .unicode-symbol {
            display: flex; align-items: center; justify-content: center;
            padding: 8px 4px; background-color: #2d2d2d;
            border: 1px solid #404040; border-radius: 4px; cursor: pointer;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            font-size: 14px; color: #d4d4d4; transition: all 0.2s;
            min-height: 32px; text-align: center;
        }
        
        .unicode-symbol:hover {
            background-color: #569cd6; color: #ffffff;
            border-color: #569cd6; transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(86, 156, 214, 0.3);
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1; display: flex; flex-direction: column;
            overflow: hidden; min-width: 0;
        }
        
        .header {
            background-color: #252526; border-bottom: 1px solid #404040;
            padding: 16px 20px; position: sticky; top: 0; z-index: 100;
        }
        
        h1 { 
            color: #569cd6; margin: 0 0 16px 0; font-size: 24px;
            text-align: left;
        }
        
        .codebase-selector {
            display: flex; align-items: center; gap: 12px; margin-bottom: 16px;
            padding: 12px; background-color: #2d2d2d; border-radius: 6px;
            border: 1px solid #404040;
        }
        
        .codebase-selector label { 
            color: #569cd6; font-weight: bold; font-size: 14px; 
        }
        
        #codebaseSelect {
            flex: 1; padding: 6px 10px; font-size: 13px;
            border: 1px solid #404040; border-radius: 4px;
            background-color: #1e1e1e; color: #d4d4d4; font-family: inherit;
        }
        
        .codebase-info { 
            color: #808080; font-size: 12px; margin-left: 8px;
        }
        
        .search-container {
            display: flex; align-items: center; gap: 12px;
        }
        
        .sidebar-toggle {
            background: none; border: 1px solid #404040; color: #569cd6;
            padding: 10px 12px; border-radius: 6px; cursor: pointer;
            font-family: inherit; font-size: 14px; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center;
            min-width: 44px; height: 44px;
        }
        
        .sidebar-toggle:hover {
            background-color: #569cd6; color: #ffffff;
            border-color: #569cd6;
        }
        
        .sidebar-toggle:focus {
            outline: none; box-shadow: 0 0 0 2px rgba(86, 156, 214, 0.4);
        }
        
        #searchInput {
            flex: 1; padding: 10px 14px; font-size: 15px;
            border: 2px solid #404040; border-radius: 6px;
            background-color: #1e1e1e; color: #d4d4d4; font-family: inherit;
            outline: none; transition: border-color 0.2s;
        }
        
        #searchInput:focus { border-color: #569cd6; }
        
        .stats { 
            color: #808080; font-size: 13px; white-space: nowrap;
            min-width: 120px; text-align: right;
        }
        
        /* Results Area */
        .content-area {
            flex: 1; overflow-y: auto; padding: 20px;
        }
        
        .results { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 12px;
        }
        
        /* Responsive 3-column layout for wide screens */
        @media (min-width: 1400px) {
            .results { 
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* 2-column layout for medium screens (like 13" MacBook Air) */
        @media (min-width: 900px) and (max-width: 1399px) {
            .results { 
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Single column for smaller screens */
        @media (max-width: 899px) {
            .sidebar { width: 240px; min-width: 240px; }
            .results { 
                grid-template-columns: 1fr;
            }
        }
        
        .lemma-card {
            background-color: #252526; border: 1px solid #404040; border-radius: 6px;
            padding: 14px; transition: border-color 0.2s, box-shadow 0.2s;
            min-height: fit-content;
        }
        
        .lemma-card:hover {
            border-color: #569cd6; box-shadow: 0 2px 8px rgba(86, 156, 214, 0.1);
        }
        
        .lemma-name { 
            color: #dcdcaa; font-weight: bold; font-size: 16px; 
            margin-bottom: 8px; line-height: 1.3;
            overflow-wrap: break-word;
        }
        
        .lemma-signature {
            color: #d4d4d4; white-space: pre-wrap; margin-bottom: 10px;
            background-color: #1e1e1e; padding: 10px; border-radius: 4px;
            border-left: 3px solid #569cd6; font-size: 13px; line-height: 1.4;
            overflow-wrap: break-word; word-break: break-all;
        }
        
        .lemma-location { 
            color: #808080; font-size: 12px; display: flex;
            align-items: center; gap: 4px;
        }
        
        .location-icon { color: #569cd6; font-size: 11px; }
        
        .no-results { 
            text-align: center; color: #808080; font-style: italic; 
            margin-top: 60px; grid-column: 1 / -1;
        }
        
        .loading { 
            text-align: center; color: #569cd6; margin-top: 60px;
            grid-column: 1 / -1;
        }
        
        .highlight { 
            background-color: #264f78; color: #fff; 
            padding: 1px 2px; border-radius: 2px; 
        }
        
        .results-limit-notice {
            grid-column: 1 / -1; text-align: center;
            color: #808080; font-size: 13px; font-style: italic;
            margin-top: 16px; padding: 12px;
            background-color: #252526; border-radius: 6px;
            border: 1px solid #404040;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #2d2d2d; }
        ::-webkit-scrollbar-thumb { 
            background: #404040; border-radius: 4px; 
        }
        ::-webkit-scrollbar-thumb:hover { background: #569cd6; }
    </style>
</head>
<body>
    <!-- Sidebar for Unicode Picker -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">Unicode Symbols</h3>
        </div>
        <div class="unicode-picker">
            <div class="unicode-category">
                <div class="category-title">Greek Letters</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="Γ">Γ</span>
                    <span class="unicode-symbol" data-symbol="Δ">Δ</span>
                    <span class="unicode-symbol" data-symbol="Σ">Σ</span>
                    <span class="unicode-symbol" data-symbol="Ψ">Ψ</span>
                    <span class="unicode-symbol" data-symbol="Ω">Ω</span>
                    <span class="unicode-symbol" data-symbol="ε">ε</span>
                    <span class="unicode-symbol" data-symbol="λ">λ</span>
                    <span class="unicode-symbol" data-symbol="σ">σ</span>
                    <span class="unicode-symbol" data-symbol="τ">τ</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Logic & Quantifiers</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="∀">∀</span>
                    <span class="unicode-symbol" data-symbol="∃">∃</span>
                    <span class="unicode-symbol" data-symbol="⊢">⊢</span>
                    <span class="unicode-symbol" data-symbol="⊣">⊣</span>
                    <span class="unicode-symbol" data-symbol="⊥">⊥</span>
                    <span class="unicode-symbol" data-symbol="⊨">⊨</span>
                    <span class="unicode-symbol" data-symbol="¬">¬</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Arrows</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="←">←</span>
                    <span class="unicode-symbol" data-symbol="↑">↑</span>
                    <span class="unicode-symbol" data-symbol="→">→</span>
                    <span class="unicode-symbol" data-symbol="↝">↝</span>
                    <span class="unicode-symbol" data-symbol="↡">↡</span>
                    <span class="unicode-symbol" data-symbol="↪">↪</span>
                    <span class="unicode-symbol" data-symbol="↬">↬</span>
                    <span class="unicode-symbol" data-symbol="⇌">⇌</span>
                    <span class="unicode-symbol" data-symbol="⇒">⇒</span>
                    <span class="unicode-symbol" data-symbol="⇘">⇘</span>
                    <span class="unicode-symbol" data-symbol="⟶">⟶</span>
                    <span class="unicode-symbol" data-symbol="⟹">⟹</span>
                    <span class="unicode-symbol" data-symbol="⟾">⟾</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Set Theory</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="∈">∈</span>
                    <span class="unicode-symbol" data-symbol="∋">∋</span>
                    <span class="unicode-symbol" data-symbol="⊆">⊆</span>
                    <span class="unicode-symbol" data-symbol="⊎">⊎</span>
                    <span class="unicode-symbol" data-symbol="⊑">⊑</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Equality & Relations</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="≊">≊</span>
                    <span class="unicode-symbol" data-symbol="≋">≋</span>
                    <span class="unicode-symbol" data-symbol="≡">≡</span>
                    <span class="unicode-symbol" data-symbol="≢">≢</span>
                    <span class="unicode-symbol" data-symbol="≤">≤</span>
                    <span class="unicode-symbol" data-symbol="≫">≫</span>
                    <span class="unicode-symbol" data-symbol="≰">≰</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Math Operators</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="×">×</span>
                    <span class="unicode-symbol" data-symbol="∙">∙</span>
                    <span class="unicode-symbol" data-symbol="∞">∞</span>
                    <span class="unicode-symbol" data-symbol="∣">∣</span>
                    <span class="unicode-symbol" data-symbol="∤">∤</span>
                    <span class="unicode-symbol" data-symbol="⋆">⋆</span>
                    <span class="unicode-symbol" data-symbol="⋈">⋈</span>
                    <span class="unicode-symbol" data-symbol="⨟">⨟</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Brackets & Delimiters</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="⟦">⟦</span>
                    <span class="unicode-symbol" data-symbol="⟧">⟧</span>
                    <span class="unicode-symbol" data-symbol="⟨">⟨</span>
                    <span class="unicode-symbol" data-symbol="⟩">⟩</span>
                    <span class="unicode-symbol" data-symbol="⌝">⌝</span>
                    <span class="unicode-symbol" data-symbol="⌞">⌞</span>
                    <span class="unicode-symbol" data-symbol="⦂">⦂</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Subscripts</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="₀">₀</span>
                    <span class="unicode-symbol" data-symbol="₁">₁</span>
                    <span class="unicode-symbol" data-symbol="₂">₂</span>
                    <span class="unicode-symbol" data-symbol="₃">₃</span>
                    <span class="unicode-symbol" data-symbol="₄">₄</span>
                    <span class="unicode-symbol" data-symbol="₅">₅</span>
                    <span class="unicode-symbol" data-symbol="₊">₊</span>
                    <span class="unicode-symbol" data-symbol="ₖ">ₖ</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Superscripts</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="²">²</span>
                    <span class="unicode-symbol" data-symbol="⁺">⁺</span>
                    <span class="unicode-symbol" data-symbol="⁻">⁻</span>
                    <span class="unicode-symbol" data-symbol="ʲ">ʲ</span>
                    <span class="unicode-symbol" data-symbol="ˣ">ˣ</span>
                    <span class="unicode-symbol" data-symbol="ᵉ">ᵉ</span>
                    <span class="unicode-symbol" data-symbol="ᵍ">ᵍ</span>
                    <span class="unicode-symbol" data-symbol="ᶜ">ᶜ</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Math Sets & Types</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="ℕ">ℕ</span>
                    <span class="unicode-symbol" data-symbol="ⅆ">ⅆ</span>
                    <span class="unicode-symbol" data-symbol="𝕄">𝕄</span>
                    <span class="unicode-symbol" data-symbol="𝕔">𝕔</span>
                    <span class="unicode-symbol" data-symbol="𝕗">𝕗</span>
                    <span class="unicode-symbol" data-symbol="𝕚">𝕚</span>
                    <span class="unicode-symbol" data-symbol="𝕛">𝕛</span>
                    <span class="unicode-symbol" data-symbol="𝕣">𝕣</span>
                    <span class="unicode-symbol" data-symbol="𝕧">𝕧</span>
                </div>
            </div>
            
            <div class="unicode-category">
                <div class="category-title">Symbols & Shapes</div>
                <div class="unicode-symbols">
                    <span class="unicode-symbol" data-symbol="□">□</span>
                    <span class="unicode-symbol" data-symbol="▶">▶</span>
                    <span class="unicode-symbol" data-symbol="◀">◀</span>
                    <span class="unicode-symbol" data-symbol="◆">◆</span>
                    <span class="unicode-symbol" data-symbol="◇">◇</span>
                    <span class="unicode-symbol" data-symbol="◈">◈</span>
                    <span class="unicode-symbol" data-symbol="◎">◎</span>
                    <span class="unicode-symbol" data-symbol="✫">✫</span>
                    <span class="unicode-symbol" data-symbol="⓪">⓪</span>
                    <span class="unicode-symbol" data-symbol="‶">‶</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="main-content">
        <div class="header">
            <h1>🔍 Agda Lemma Search</h1>
            
            <div class="codebase-selector">
                <label for="codebaseSelect">Codebase:</label>
                <select id="codebaseSelect">
                    <option value="Main Agda">Main Agda (912 lemmas)</option> 
                    <option value="Spine Variant">Spine Variant (940 lemmas)</option>
                </select>
                <div class="codebase-info" id="codebaseInfo"></div>
            </div>
            
            <div class="search-container">
                <button class="sidebar-toggle" id="sidebarToggle" title="Toggle Unicode Sidebar">
                    ◐
                </button>
                <input type="text" id="searchInput" 
                       placeholder="Search lemmas... (use spaces for multiple terms, e.g., 'regular =⟹')"
                       autocomplete="off">
                <div class="stats" id="stats">Loading codebases...</div>
            </div>
        </div>
        
        <div class="content-area">
            <div class="results" id="results">
                <div class="loading">Loading lemma indices...</div>
            </div>
        </div>
    </div>

    <script>
        let currentLemmas = [];
        let codebaseData = {};
        let currentCodebase = null;
        
        async function loadCodebaseMetadata() {
            try {
                const response = await fetch('codebases.json');
                const data = await response.json();
                codebaseData = data.codebases;
                currentCodebase = data.default_codebase;
                
                // Set default selection
                document.getElementById('codebaseSelect').value = currentCodebase;
                
                // Load the default codebase
                await loadCodebase(currentCodebase);
                
            } catch (error) {
                console.error('Error loading codebase metadata:', error);
                document.getElementById('results').innerHTML = 
                    '<div class="no-results">Error loading codebase configuration.</div>';
            }
        }
        
        async function loadCodebase(nickname) {
            try {
                const info = codebaseData[nickname];
                if (!info) throw new Error(`Codebase '${nickname}' not found`);
                
                document.getElementById('stats').textContent = 'Loading...';
                document.getElementById('results').innerHTML = '<div class="loading">Loading lemmas...</div>';
                
                const response = await fetch(info.filename);
                if (!response.ok) throw new Error(`Failed to load ${info.filename}`);
                
                currentLemmas = await response.json();
                currentCodebase = nickname;
                
                // Update UI
                document.getElementById('codebaseInfo').textContent = info.description;
                document.getElementById('stats').textContent = `${currentLemmas.length} lemmas ready`;
                displayResults(currentLemmas);
                
                // Clear search when switching codebases
                document.getElementById('searchInput').value = '';
                
            } catch (error) {
                console.error('Error loading codebase:', error);
                document.getElementById('results').innerHTML = 
                    `<div class="no-results">Error loading codebase: ${error.message}</div>`;
            }
        }
        
        let searchTimeout;
        function performSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = document.getElementById('searchInput').value.trim();
                
                if (!query) {
                    displayResults(currentLemmas);
                    document.getElementById('stats').textContent = `${currentLemmas.length} lemmas ready`;
                    return;
                }
                
                // Split query into individual terms for fuzzy search
                const terms = query.toLowerCase().split(/\s+/).filter(term => term.length > 0);
                
                if (terms.length === 0) {
                    displayResults(currentLemmas);
                    return;
                }
                
                // Score each lemma based on how well it matches
                const scoredResults = currentLemmas.map(lemma => {
                    let score = 0;
                    const nameLower = lemma.name.toLowerCase();
                    const sigLower = lemma.signature.toLowerCase();
                    
                    // Check if ALL terms are matched first (required)
                    const allTermsMatched = terms.every(term => 
                        nameLower.includes(term) || sigLower.includes(term) || lemma.file.toLowerCase().includes(term)
                    );
                    
                    if (!allTermsMatched) return { lemma, score: 0 };
                    
                    for (let i = 0; i < terms.length; i++) {
                        const term = terms[i];
                        const isFirstTerm = i === 0;
                        const termWeight = isFirstTerm ? 3 : 1; // First term gets triple weight
                        
                        // Name matches (heavily weighted) - prioritize exact and prefix matches
                        if (nameLower.includes(term)) {
                            if (nameLower === term) score += 200 * termWeight; // Exact name match
                            else if (nameLower.startsWith(term)) score += 100 * termWeight; // Name starts with term
                            else if (nameLower.indexOf(term) === 0) score += 80 * termWeight; // Name begins with term
                            else {
                                // Check position in name - earlier is better
                                const position = nameLower.indexOf(term);
                                const positionBonus = Math.max(0, 20 - position); // Earlier = higher bonus
                                score += (15 + positionBonus) * termWeight; // Name contains term
                            }
                        }
                        
                        // Signature matches (lower weight)
                        if (sigLower.includes(term)) {
                            score += 5 * termWeight;
                        }
                        
                        // File path matches (lowest weight)
                        if (lemma.file.toLowerCase().includes(term)) {
                            score += 1 * termWeight;
                        }
                    }
                    
                    // Bonus for matching all terms in name (strong preference)
                    const allTermsInName = terms.every(term => nameLower.includes(term));
                    const allTermsInSig = terms.every(term => sigLower.includes(term));
                    
                    if (allTermsInName) score += 50; // Strong bonus for all terms in name
                    else if (allTermsInSig) score += 20; // Medium bonus for all terms in signature
                    
                    return { lemma, score };
                }).filter(result => result.score > 0);
                
                // Sort by score (highest first)
                scoredResults.sort((a, b) => b.score - a.score);
                const resultLemmas = scoredResults.map(result => result.lemma);
                
                displayResults(resultLemmas, query);
                document.getElementById('stats').textContent = 
                    `${resultLemmas.length} of ${currentLemmas.length} lemmas match "${terms.join(' ')}"`;
                
            }, 150);
        }
        
        function displayResults(results, query = '') {
            const resultsContainer = document.getElementById('results');
            
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="no-results">No lemmas found</div>';
                return;
            }
            
            const cardsHtml = results.slice(0, 50).map(lemma => {
                const highlightedName = highlightText(lemma.name, query);
                const highlightedSignature = highlightText(lemma.signature, query);
                
                return `
                    <div class="lemma-card">
                        <div class="lemma-name">${highlightedName}</div>
                        <div class="lemma-signature">${highlightedSignature}</div>
                        <div class="lemma-location">
                            <span class="location-icon">📁</span>
                            ${lemma.file}:${lemma.line}
                        </div>
                    </div>
                `;
            }).join('');
            
            const limitNotice = results.length > 50 ? 
                `<div class="results-limit-notice">Showing first 50 of ${results.length} results</div>` : '';
            
            resultsContainer.innerHTML = cardsHtml + limitNotice;
        }
        
        function highlightText(text, query) {
            if (!query) return escapeHtml(text);
            const escapedText = escapeHtml(text);
            const words = query.toLowerCase().split(/\s+/).filter(w => w.length > 0);
            let highlighted = escapedText;
            words.forEach(word => {
                const regex = new RegExp(`(${escapeRegExp(word)})`, 'gi');
                highlighted = highlighted.replace(regex, '<span class="highlight">$1</span>');
            });
            return highlighted;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        // Event listeners
        document.getElementById('searchInput').addEventListener('input', performSearch);
        document.getElementById('searchInput').addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                this.value = ''; performSearch(); this.blur();
            }
            // Toggle sidebar with Ctrl/Cmd + B
            if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                e.preventDefault();
                sidebarToggle.click();
            }
        });
        
        document.getElementById('codebaseSelect').addEventListener('change', function(e) {
            loadCodebase(e.target.value);
        });
        
        // Sidebar toggle functionality
        const sidebar = document.querySelector('.sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        let sidebarCollapsed = false;
        
        sidebarToggle.addEventListener('click', function() {
            sidebarCollapsed = !sidebarCollapsed;
            
            if (sidebarCollapsed) {
                sidebar.classList.add('collapsed');
                sidebarToggle.textContent = '◑';
                sidebarToggle.title = 'Show Unicode Sidebar';
            } else {
                sidebar.classList.remove('collapsed');
                sidebarToggle.textContent = '◐';
                sidebarToggle.title = 'Hide Unicode Sidebar';
            }
        });
        
        // Unicode picker functionality
        const unicodePicker = document.querySelector('.unicode-picker');
        const searchInput = document.getElementById('searchInput');
        
        // Add click handlers for all unicode symbols
        unicodePicker.addEventListener('click', function(e) {
            if (e.target.classList.contains('unicode-symbol')) {
                const symbol = e.target.getAttribute('data-symbol');
                insertUnicodeSymbol(symbol);
            }
        });
        
        function insertUnicodeSymbol(symbol) {
            const cursorPos = searchInput.selectionStart;
            const currentValue = searchInput.value;
            const newValue = currentValue.slice(0, cursorPos) + symbol + currentValue.slice(searchInput.selectionEnd);
            
            searchInput.value = newValue;
            searchInput.focus();
            
            // Set cursor position after the inserted symbol
            const newCursorPos = cursorPos + symbol.length;
            searchInput.setSelectionRange(newCursorPos, newCursorPos);
            
            // Trigger search
            performSearch();
        }
        
        // Initialize
        loadCodebaseMetadata();
    </script>
</body>
</html>